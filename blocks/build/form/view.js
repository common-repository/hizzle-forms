(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var s in r)e.o(r,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:r[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.apiFetch;var r=e.n(t);const s=window.wp.i18n,i=window.wp.domReady;var a=e.n(i);const o={name:"required",defaultMessage:((0,s.__)("Required","hizzle-forms"),(0,s.__)("Is this field required?","hizzle-forms"),(0,s.__)("This field is required.","hizzle-forms")),validate:function(e){return e.length>0}},l={name:"maxdate",defaultMessage:((0,s.__)("Maximum date","hizzle-forms"),(0,s.__)("Set a maximum date?","hizzle-forms"),(0,s.__)("The latest date allowed is {threshold}.","hizzle-forms")),validate:function(e,t){return!(/^[0-9]{4,}-[0-9]{2}-[0-9]{2}$/.test(e)&&/^[0-9]{4,}-[0-9]{2}-[0-9]{2}$/.test(t.threshold)&&e>t.threshold)}},n={name:"mindate",defaultMessage:((0,s.__)("Minimum date","hizzle-forms"),(0,s.__)("Set a minimum date?","hizzle-forms"),(0,s.__)("The earliest date allowed is {threshold}.","hizzle-forms")),validate:function(e,t){return!(/^[0-9]{4,}-[0-9]{2}-[0-9]{2}$/.test(e)&&/^[0-9]{4,}-[0-9]{2}-[0-9]{2}$/.test(t.threshold)&&e<t.threshold)}},h={name:"maxnumber",defaultMessage:((0,s.__)("Maximum number","hizzle-forms"),(0,s.__)("Set a maximum number?","hizzle-forms"),(0,s.__)("The value must be at most {threshold}.","hizzle-forms")),validate:function(e,t){return!(parseFloat(e)>parseFloat(t.threshold))}},m={name:"minnumber",defaultMessage:((0,s.__)("Minimum number","hizzle-forms"),(0,s.__)("Set a minimum number?","hizzle-forms"),(0,s.__)("The value must be at least {threshold}.","hizzle-forms")),validate:function(e,t){return!(parseFloat(e)<parseFloat(t.threshold))}},d={name:"maxitems",defaultMessage:((0,s.__)("Maximum items","hizzle-forms"),(0,s.__)("Set a maximum number of selectable items?","hizzle-forms"),(0,s.__)("You must select at most {threshold} items.","hizzle-forms")),validate:function(e,t){return!(e.length>parseInt(t.threshold))}},u={name:"minitems",defaultMessage:((0,s.__)("Minimum items","hizzle-forms"),(0,s.__)("Set a minimum number of selectable items?","hizzle-forms"),(0,s.__)("You must select at least {threshold} items.","hizzle-forms")),validate:function(e,t){return!(e.length<parseInt(t.threshold))}},c={name:"maxlength",defaultMessage:((0,s.__)("Maximum length","hizzle-forms"),(0,s.__)("Set a maximum length?","hizzle-forms"),(0,s.__)("The value must be at most {threshold} characters long.","hizzle-forms")),validate:function(e,t){return!(e.length>parseInt(t.threshold))}},f={name:"minlength",defaultMessage:((0,s.__)("Minimum length","hizzle-forms"),(0,s.__)("Set a minimum length?","hizzle-forms"),(0,s.__)("The value must be at least {threshold} characters long.","hizzle-forms")),validate:function(e,t){return!(e.length<parseInt(t.threshold))}},z={[o.name]:o,[l.name]:l,[n.name]:n,[h.name]:h,[m.name]:m,[d.name]:d,[u.name]:u,[c.name]:c,[f.name]:f};class _{submissionAttempted=!1;errors=[];rules=[];field=null;constructor(e,t){this.field=e,this.rules=t,this.initEventListeners()}initEventListeners(){this.field.querySelectorAll("input, select, textarea").forEach((e=>{e.addEventListener("blur",(()=>{this.validate()})),e.addEventListener("input",(()=>{this.submissionAttempted&&this.validate()}))}))}validate(){this.errors=[];const e=this.getValue();this.rules.forEach((t=>{if(!z[t.name])return;if(z[t.name].validate(e,t))return;let r=t.errorMessage||z[t.name].defaultMessage;Object.keys(t).forEach((e=>{r=r.replace(`{${e}}`,t[e])})),this.errors.push(r)})),this.toggleError()}getValue(){if(this.field.classList.contains("wp-block-hizzle-forms-radio")){const e=[];let t=!1;return this.field.querySelectorAll("input").forEach((r=>{t="checkbox"===r.type,r.checked&&e.push(r.value)})),t?e:e[0]||""}if(this.field.classList.contains("wp-block-hizzle-forms-checkbox")){const e=this.field.querySelector('input[type="checkbox"]');return!!e&&e.checked}const e=this.field.querySelector("select, input, textarea");return e?e.value:""}toggleError(){const e=this.field.querySelector(".hizzle-forms__field-error");if(this.errors.length)return e.innerHTML=this.errors[0],void this.field.classList.add("hizzle-forms__field--has-error");e.innerHTML="",this.field.classList.remove("hizzle-forms__field--has-error")}}const g=(e,t,r)=>{if(""===e)return t;const s=e.split("[");if(1===s.length)return{...r,[e]:t};if(2===s.length){const[e,i]=s,a=i.slice(0,-1);if(""===a){const s=r[e]||[];return s.push(t),{...r,[e]:s}}const o=r[e]||{};return{...r,[e]:{...o,[a]:t}}}const[i,...a]=s;let o=a.join("[");if(!o.startsWith("]")){const e=r[i]||{};return{...r,[i]:g(o.replace(/\]/,""),t,e)}}const l=r[i]||[];return l.push(g(o.slice(1).replace(/\[/,"").replace(/\]/,""),t,{})),{...r,[i]:l}},p=e=>{let t={};return e.forEach(((e,r)=>{t=g(r,e,t)})),t},v=(new Date).getTime();a()((()=>{document.querySelectorAll(".wp-block-hizzle-forms-form").forEach((e=>{const t=function(e){const t={};return e.querySelectorAll(".hizzle-forms-field").forEach((e=>{const r=e.dataset.instanceId;try{let s=e.dataset.validation?JSON.parse(e.dataset.validation):[];Array.isArray(s)||(s=[]),r&&(t[r]=new _(e,s))}catch(s){t[r]=new _(e,[]),console.error(s)}})),{errors:[],fields:t,validate(){let e=!1;return this.errors=[],Object.keys(t).forEach((r=>{t[r].submissionAttempted=!0,t[r].validate(),t[r].errors.length&&(e=!0)})),!e},displayError(e,r){if(t[e])return t[e].errors=[r],void t[e].toggleError();this.errors=[r],this.toggleError()},toggleError(){const t=e.querySelector(".hizzle-forms__form-error");if(this.errors.length)return t.innerHTML=this.errors[0],void t.classList.add("hizzle-forms__form--has-error");t.innerHTML="",t.classList.remove("hizzle-forms__form--has-error")}}}(e);e.querySelectorAll("input, select, textarea").forEach((e=>{e.addEventListener("change",(()=>{t.errors.length>0&&(t.errors=[],t.toggleError())}))}));const i=()=>{const t=e.querySelector(".hizzle-forms__field--has-error");t&&t.scrollIntoView({behavior:"smooth"})};e.addEventListener("submit",(a=>{if(a.preventDefault(),!t.validate())return void i();const o=e.dataset.instanceId,l=new FormData(e);l.append("hizzle_conversion_page",window.location.href),l.append("hizzle_referrer",document.referrer),l.append("hizzle_time_to_submit",((new Date).getTime()-v)/1e3),e.classList.add("hizzle-forms-submitting"),r()({path:"/hizzle/v1/forms/submit/"+o,method:"POST",data:p(l)}).then((t=>("message"===t.action&&(e.outerHTML=`<div class="wp-block-hizzle-forms__success-message">${t.message}</div>`,e.classList.remove("hizzle-forms-submitting")),"redirect"===t.action&&(window.location.href=t.redirect),t))).catch((r=>{r.code?(t.displayError(r.code,r.message),r.additional_errors&&r.additional_errors.forEach((e=>{t.displayError(e.code,e.message)}))):t.displayError("unknown",(0,s.__)("An unknown error occurred while submitting the form. Check your network connectivity then try again.","hizzle-forms")),e.classList.remove("hizzle-forms-submitting"),i()}))}))}))}))})();